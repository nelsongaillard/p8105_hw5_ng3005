p8105_hw5_ng3005
================
Nelson Gaillard
2025-11-12

``` r
library(tidyverse)
library(rvest)
library(broom)
```

## Problem 2

##### Generate `mu` and `p-value`

``` r
sim = function(n, mu, sigma) {
  x = rnorm(n, mean = mu, sd = sigma)
  ttest = t.test(x, mu = 0) 

  tibble(
    mu_hat = ttest$estimate,
    p_value = ttest$p.value
  )
}
```

##### Run 6 simulations for `mu`

``` r
set.seed(1)

results = map(0:6, function(mu) {
  map(1:5000, ~sim(n = 30, mu = mu, sigma = 5)) |> 
  bind_rows() |> 
    mutate(true_mu = mu)
  }) |> 
  bind_rows()
```

##### Association between effect size and power

Compute power for each `mu`

``` r
power_df = results |> 
  group_by(true_mu) |> 
  summarize(power = mean(p_value < 0.05))
```

Plot of `power` vs `mu`

``` r
power_df |> 
  ggplot(aes(x = true_mu, y = power)) +
  geom_line() +
  geom_point() +
  labs(
    x = "True mean (mu)",
    y = "Power (Probability of rejecting H_0",
    title = "Power as Effect Size Increases"
  )
```

![](p8105_hw5_ng3005_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

As shown in the plot, as the true mean (mu) increases, the probability
of rejecting the null hypothesis (H_0) increases. The data level off
around 1.00 when `mu = 5` and `mu = 6`.

Compute `mu_hat` means

``` r
summary_df = results |> 
  group_by(true_mu) |> 
  summarize(
    mean_mu_hat = mean(mu_hat),
    mean_mu_hat_sig = mean(mu_hat[p_value < 0.05])
  )
```

Create plot

``` r
summary_df |> 
  ggplot(aes(true_mu)) +
  geom_line(aes(y = mean_mu_hat), color = "blue") +
  geom_point(aes(y = mean_mu_hat), color = "blue") +
  geom_line(aes(y = mean_mu_hat_sig), color = "red") +
  geom_point(aes(y = mean_mu_hat_sig), color = "red") +
  labs(
    x = "True mean (mu)",
    y = "Average (mu_hat)",
    title  = "Average mu_hat vs mu"
  )
```

![](p8105_hw5_ng3005_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

Based on the plot, the sample average of `mu_hat` across tests for which
the null is reject is approximately equal to the true value of `mu` when
`mu ≥ 4`. For small effect sizes, however, the average `mu_hat` is
greater than the true `mu`. This happens due to bias, and when we
increase the statistical power (i.e. when `mu ≥ 4`), the bias is
mitigated.

## Problem 3

##### Load in the data

``` r
washington_post =
  read_csv("data/homicide-data.csv", na = c("NA", ".", "")) |> 
  janitor::clean_names()
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

This dataset includes the number of homicides in various cities
throughout the US. The data includes the date of the incident
(`reported_date`), the victims’ names (`victims_last`, `victims_first`),
the race of the victim (`victim_race`), the age of the victim
(`victim_age`), the sex of the victim (`victim_sex`), the location of
the incident (`city`, `state`, `lat`, `lon`), and the perpetrator’s
disposition (`disposition`).

Create `city_state` variable

``` r
washington_post =
  washington_post |> 
  mutate(city_state = paste(city, state, sep = ", "),
         unsolved = disposition %in% c("Closed without arrest", "Open/No arrest")
  )
```

Summarize total homicides and number of unsolved cases in each city

``` r
washington_post |> 
  group_by(city_state) |> 
  summarize(
    total_homicides = n(),
    unsolved_cases = sum(unsolved)
  ) |> 
  knitr::kable()
```

| city_state         | total_homicides | unsolved_cases |
|:-------------------|----------------:|---------------:|
| Albuquerque, NM    |             378 |            146 |
| Atlanta, GA        |             973 |            373 |
| Baltimore, MD      |            2827 |           1825 |
| Baton Rouge, LA    |             424 |            196 |
| Birmingham, AL     |             800 |            347 |
| Boston, MA         |             614 |            310 |
| Buffalo, NY        |             521 |            319 |
| Charlotte, NC      |             687 |            206 |
| Chicago, IL        |            5535 |           4073 |
| Cincinnati, OH     |             694 |            309 |
| Columbus, OH       |            1084 |            575 |
| Dallas, TX         |            1567 |            754 |
| Denver, CO         |             312 |            169 |
| Detroit, MI        |            2519 |           1482 |
| Durham, NC         |             276 |            101 |
| Fort Worth, TX     |             549 |            255 |
| Fresno, CA         |             487 |            169 |
| Houston, TX        |            2942 |           1493 |
| Indianapolis, IN   |            1322 |            594 |
| Jacksonville, FL   |            1168 |            597 |
| Kansas City, MO    |            1190 |            486 |
| Las Vegas, NV      |            1381 |            572 |
| Long Beach, CA     |             378 |            156 |
| Los Angeles, CA    |            2257 |           1106 |
| Louisville, KY     |             576 |            261 |
| Memphis, TN        |            1514 |            483 |
| Miami, FL          |             744 |            450 |
| Milwaukee, wI      |            1115 |            403 |
| Minneapolis, MN    |             366 |            187 |
| Nashville, TN      |             767 |            278 |
| New Orleans, LA    |            1434 |            930 |
| New York, NY       |             627 |            243 |
| Oakland, CA        |             947 |            508 |
| Oklahoma City, OK  |             672 |            326 |
| Omaha, NE          |             409 |            169 |
| Philadelphia, PA   |            3037 |           1360 |
| Phoenix, AZ        |             914 |            504 |
| Pittsburgh, PA     |             631 |            337 |
| Richmond, VA       |             429 |            113 |
| Sacramento, CA     |             376 |            139 |
| San Antonio, TX    |             833 |            357 |
| San Bernardino, CA |             275 |            170 |
| San Diego, CA      |             461 |            175 |
| San Francisco, CA  |             663 |            336 |
| Savannah, GA       |             246 |            115 |
| St. Louis, MO      |            1677 |            905 |
| Stockton, CA       |             444 |            266 |
| Tampa, FL          |             208 |             95 |
| Tulsa, AL          |               1 |              0 |
| Tulsa, OK          |             583 |            193 |
| Washington, DC     |            1345 |            589 |
